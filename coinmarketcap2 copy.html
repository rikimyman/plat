<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CoinMarketCap Enhanced with Live Global Data</title>
  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Add after your existing Chart.js script -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    /* Global Styles */
    html { scroll-behavior: smooth; }
    :root {
      --primary-bg: rgb(20, 22, 24);
      --secondary-bg: #2a3239;
      --tertiary-bg: #454547;
      --text-primary: #bab7b7;
      --text-secondary: #f6db79;
      --accent-green: #2ed573;
      --accent-red: #ff4757;
      --accent-blue: #434546;
      --border-color: #222222;
      --card-shadow: 0 4px 6px rgba(151, 155, 154, 0.1);
      --flash-duration: 800ms;
      --accent-theme: #71777f;
      --cardbg: #707273;
      --buttonbg: #f6db79;
      --loaderbg: #7dc84a;
      --loaderborderbg: #818581;
      --graph-secondary: hsl(211, 41%, 61%);
    }
    body.light-theme {
      --primary-bg: #D9D9D9;
      --secondary-bg: #f0f0f0;
      --tertiary-bg: #e0e0e0;
      --text-primary: #000000;
      --text-secondary: #333333;
      --accent-blue: #f3f4ef;
      --cardbg: #535252;
      --buttonbg: #000000;
    }

    
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background-color: var(--primary-bg); color: var(--text-primary); }

    /* Header Styles */
    header { padding: 0.5rem; border-bottom: 1px solid var(--border-color); }
    .header-container {
      max-width: 1700px; margin: 0 auto; display: flex;
      justify-content: space-between; align-items: center;
    }
    .header-left, .header-center, .header-right { display: flex; align-items: center; gap: 1rem; }
    .header-left .brand { display: flex; align-items: center; gap: 0.5rem; }
    .brand-logo { width: 45px; height: 45px; border-radius: 90px }
    .header-center nav a {
      margin: 0 0.75rem; color: var(--text-secondary); text-decoration: none;
      transition: color 0.3s; font-weight: bold;
    }
    
    .button {
      background: transparent; color: var(--text-primary); padding: 0.5rem 1.5rem;
      border-radius: 20px; text-decoration: none; font-weight: bold;
      transition: background 0.3s, transform 0.3s; border: 2px solid var(--cardbg);
    }
    .button:hover { background: transparent; transform: translateY(-3px); border-color: var(--buttonbg); }
    .search-bar {
      padding: 0.5rem 1rem; border-radius: 20px; background: transparent;
      border: 2px solid var(--cardbg); color: var(--text-primary); outline: none;
    }
    .header-right { position: relative; gap: 1rem; }

    /* Settings Button & Menu */
    .settings-btn {
      background: transparent; border: none; color: var(--text-secondary);
      font-size: 1.5rem; cursor: pointer; transition: transform 0.3s, color 0.3s;
    }
    .settings-btn:hover { color: var(--accent-blue); }
    .settings-btn.active { transform: rotate(45deg); }
    .settings-menu {
      position: absolute; top: 120%; right: 0; background: var(--tertiary-bg);
      border: 1px solid var(--border-color); box-shadow: var(--card-shadow);
      border-radius: 5px; padding: 0.5rem; display: none; flex-direction: column;
      z-index: 10; animation: fadeIn 0.3s ease-out; min-width: 120px;
    }
    .settings-menu button {
      background: transparent; border: none; color: var(--text-secondary);
      padding: 0.5rem 1rem; text-align: left; cursor: pointer; font-size: 1rem;
      transition: background 0.3s;
    }
    .settings-menu button:hover { background: var(--secondary-bg); color: var(--accent-blue); }
    
    /* Theme Switch (Toggle) Styles */
    .theme-switch {
  display: inline-block;
  position: relative;
  width: 60px; /* Reduced from 80px */
  height: 30px; /* Reduced from 40px */
  margin-left: 1rem;
}
    .theme-switch input {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }
    .switch-track {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: #2a3239;
  border-radius: 34px;
  width: 100%;
  height: 100%;
  padding: 8px; /* Reduced from 12px */
  transition: background-color 0.4s;
  font-size: 0.7rem; /* Reduced from 0.9rem */
  color: #4b4f4d;
  position: relative;
}
    .switch-option {
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    /* Initially, assume dark mode is active */
    .option-dark { opacity: 1; }
    .option-light { opacity: 0.4; }
    .switch-thumb {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 24px; /* Reduced from 34px */
  height: 24px; /* Reduced from 34px */
  background-color: #ffffff;
  border-radius: 50%;
  transition: transform 0.5s;
}
    /* When checked (light theme active) */
    .theme-switch input:checked + .switch-track {
      background-color: var(--accent-theme);
    }
    .theme-switch input:checked + .switch-track .switch-thumb {
      transform: translateX(30px);
    }
    .theme-switch input:checked + .switch-track .option-dark {
      opacity: 0.4;
    }
    .theme-switch input:checked + .switch-track .option-light {
      opacity: 1;
    }
    /* Main Container */
    .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }

    /* Global Stats */
    .market-stats {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem; margin: 2rem 0;
    }
    .stat-card {
  width: 200px;
  height: 60px;
  padding: 0.3rem;
  border-radius: 34px;
  text-align: center;
  font-style: italic;
  font-size: 12px;
  background-color: transparent;
  border: 2px solid var(--cardbg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.stat-card h3 { 
  color: var(--text-secondary); 
  margin-bottom: 0.5rem;
  font-size: 13px;
}

.stat-value { 
  font-size: 1rem; 
  font-weight: 600;
}
.global-stat-card#global-marketcap, 
.global-stat-card#global-volume, 
.global-stat-card#btc-dominance, 
.global-stat-card#btc-founding-rate,
.global-stat-card#eth-founding-rate {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  text-align: left;
  width: 100%; /* Changed from 25% to 100% */
  margin-top: 10px;
  border: 2.5px solid var(--cardbg);
  border-radius: 15px;
  padding: 15px;
}
.global-stat-card#global-marketcap, 
.global-stat-card#global-volume, 
.global-stat-card#btc-dominance, 
.global-stat-card#btc-founding-rate,
.global-stat-card#eth-founding-rate {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
  text-align: left;
  width: 100%; /* Changed from 25% to 100% */
  margin-top: 10px;
  border: 2.5px solid var(--cardbg);
  border-radius: 15px;
  padding: 15px;
}

/* Make sure the grid layout is working properly */
.global-stats-row {
  display: grid;
  grid-template-columns: 1fr 1fr; /* Two equal columns */
  gap: 15px;
  width: 100%;
  margin-bottom: 15px;
}

/* Ensure the container is properly sized */
.global-stats-container {
  width: 100%;
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 0 16px;
}

/* Fix BTC dominance specific styling */
#btc-dominance {
  position: relative;
  height: 150px;
  width: 100%; /* Changed from 200px to 100% */
  padding: 0.3rem;
}
#btc-dominance {
  position: relative;
  height: 150px;
  width: 200px;
  padding: 0.3rem;
}
.global-stat-card .stat-title,
.global-stat-card h3 {
  text-align: left;
  margin-bottom: 8px;
  font-size: 13px;
  color: var(--text-secondary);
}
.global-stat-card .stat-title,
.global-stat-card .stat-value {
  text-align: left;
  align-self: flex-start;
}
.global-stat-card .stat-value,
.global-stat-card .founding-rate {
  text-align: left;
  font-size: 1rem;
  font-weight: bold;
}
.global-stat-card .stat-loading {
  align-self: flex-start;
  justify-content: flex-start;
}

    /* Loading Animation for Stat Cards */
    .stat-loading {
      display: flex;
      justify-content: center;
      gap: 5px;
    }
    .stat-loading .dot {
      width: 6px;
      height: 6px;
      background: var(--text-primary);
      border-radius: 50%;
      animation: blink 1.4s infinite both;
    }
    .stat-loading .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .stat-loading .dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0.2; }
      40% { opacity: 1; }
    }
    
    .fear-greed {
      background: linear-gradient(135deg, #cfdc1b 0%, #e74c3c 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    /* Trending Cards */
    .trending { margin: 2rem 0; }
    .trending-container {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 1.5rem;
    }
    .trending-card {
      background: var(--secondary-bg); padding: 0.8rem; border-radius: 34px; width: 32px;
      box-shadow: var(--card-shadow); cursor: pointer; transition: transform 0.2s;
      position: relative;
    }
    .trending-card:hover { transform: translateY(-5px); }
    .trending-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .trending-header img { width: 32px; height: 32px; border-radius: 50%; }
    .trending-details { font-size: 0.9rem; margin-bottom: 0.5rem; }
    .trending-chart canvas { width: 195px !important; height: 80px !important; }

    /* ================================
       UPDATED COIN DETAIL WINDOW UI
       ================================ */
    .coin-details-section {
      background: linear-gradient(145deg, rgba(30, 32, 34, 0.95), rgba(40, 42, 44, 0.95));
      border-radius: 24px;
      display: none;
      padding: 2.5rem;
      margin: 2rem auto;
      max-width: 1200px;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .close-details {
      position: absolute;
      top: 1rem; right: 1rem;
      cursor: pointer;
      font-size: 1.5rem;
      color: var(--text-secondary);
    }
    /* Settings button & panel inside the detail window */
    #detailSettingsBtn {
      position: absolute;
      top: 52.5%;
      left: 93.3%;
      transition: transform 0.3s;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 10;
    }
    #detailSettingsBtn.rotated { transform: rotate(45deg); }
    #detailSettingsPanel {
      display: none;
      position: absolute;
      top: 53.5%;
      left: 79.7%;
      background: transparent;
      border: 2px solid var(--cardbg);
      padding: 0.8rem;
      border-radius: 12px;
      z-index: 20;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(10px);
      min-width: 150px;
      
    }
    
    #detailSettingsPanel h3 {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    
    #detailSettingsPanel label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
      font-size: 0.9rem;
    }
    
    #detailSettingsPanel input[type="color"] {
      width: 100%;
      height: 30px;
      border: 2px solid var(--cardbg);
      border-radius: 8px;
    }
    
    #detailSettingsPanel input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }
    
    #detailSettingsPanel input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 6px;
    }
    


    
    
    
    /* Header: Coin Info & Buyers/Sellers Widget */
    .coin-details-header {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 2rem;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .price-info {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    .price-info img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(200, 243, 81, 0.2);
      padding: 5px;
      background: rgba(255, 255, 255, 0.05);
    }
    .price-info h2 {
      font-size: 1.5rem;
      margin: 0;
    }
    .current-price {
      font-size: 1.2rem;
      margin-top: 0.3rem;
      color: var(--accent-green);
    }
    /* Buyers/Sellers Widget – UPDATED with Lighter, Captivating Colors */
    .buyers-sellers-widget {
      width: 300px;
      border-radius: 20px;
      overflow: hidden;
      background: transparent;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      padding: 0.5rem;
      border: px solid var(--cardbg);
    }
    
    .ratio-container {
      height: 40px;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      position: relative;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .ratio-buyers {
      background: linear-gradient(45deg, #2ed573, #7bed9f);
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .ratio-sellers {
      background: linear-gradient(45deg, #ff4757, #c65465);
      transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .ratio-buyers span,
    .ratio-sellers span {
      font-size: 0.9rem;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      color: rgba(255, 255, 255, 0.95);
      padding: 0 1rem;
      white-space: nowrap;
      z-index: 2;
    }
    
    .ratio-buyers::after,
    .ratio-sellers::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(rgba(255, 255, 255, 0.1), transparent);
    }
    text-align: center;
    
    .stat-item:hover {
      transform: translateY(-5px);
      background: rgba(180, 173, 173, 0.05);
    }
    
    /* Coin Stats Box */
    .coin-stats-box {
      background: transparent;
      border-radius: 16px;
      padding: 1.5rem;
      margin: 1.2rem 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
    }
    .coin-stats-box .stat-item { text-align: center; }
    .coin-stats-box .stat-item span {
      display: block;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    .coin-stats-box .stat-item div {
      font-size: 1rem;
      font-weight: bold;
      margin-top: 5px;
    }
    .stat-item {
      padding: 1rem;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      transition: transform 0.3s ease;
      border: 2px solid var(--cardbg);
    }
    #nerdBtn {
      margin-top: 20px;
      display: block;
    }
    
    /* Timeframe Selector and Chart */
    .timeframe-selector {
      background: transparent;
      padding: 1rem;
      border-radius: 16px;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .timeframe-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      border: 2px solid transparent;
      background: rgba(237, 233, 233, 0.05);
      color: var(--text-secondary);
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .timeframe-btn:hover {
      background: rgba(182, 245, 8, 0.1);
      transform: translateY(-2px);
      border: 2px solid var(--cardbg);
    }
    
    .timeframe-btn.active {
      background: var(--accent-blue);
      color: white;
      box-shadow: 0 4px 12px rgba(200, 243, 81, 0.2);
    }
    
    .detail-chart-container {
      background: transparent;
      border-radius: 16px;
      padding: 1.5rem;
      margin-top: 2rem;
      height: 300px;
      border: 1.4px solid var(--cardbg);
    }
    #detailChart {
      width: 100%;
      height: 100%;
    }
    .expanding-logo {
      width: 0;
      opacity: 0;
      animation: expandLogo 1.2s backwards;
      margin-bottom: 20px;
    }
    @keyframes expandLogo {
      0% { width: 0; opacity: 0; }
      100% { width: 150px; opacity: 1; }
    }
    .spinner {
      border: 4px solid var(--loaderborderbg);
      border-top: 4px solid var(--loaderbg);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-top: 10px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
  
    .small-loader {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin-top: 10px;
    }
    .small-loader .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #fff;
      animation: blink 1.4s infinite both;
    }
    .small-loader .dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    .small-loader .dot:nth-child(3) {
      animation-delay: 0.1s;
    }
  
    

    @keyframes blink {
      0% { opacity: 0.2; }
      40% { opacity: 1; }
      80%, 100% { opacity: 0.2; }
    }
    
    @keyframes shake {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      10% { transform: translate(-1px, -2px) rotate(-1deg); }
      20% { transform: translate(-3px, 0px) rotate(1deg); }
      30% { transform: translate(3px, 2px) rotate(0deg); }
      40% { transform: translate(1px, -1px) rotate(1deg); }
      50% { transform: translate(-1px, 2px) rotate(-1deg); }
      60% { transform: translate(-3px, 1px) rotate(0deg); }
      70% { transform: translate(3px, 1px) rotate(-1deg); }
      80% { transform: translate(-1px, -1px) rotate(1deg); }
      90% { transform: translate(1px, 2px) rotate(0deg); }
      100% { transform: translate(1px, -2px) rotate(-1deg); }
    }

    
    
    #btc-founding-rate h3 {
      font-size: 13px;
      margin-bottom: 0.3rem;
    }
    
    #btc-founding-rate .stat-value {
      font-size: 1rem;
    }
    
    .founding-rate {
      font-weight: bold;
      font-style: italic;
    }
    

  
    
    #eth-founding-rate h3 {
      font-size: 13px;
      margin-bottom: 0.3rem;
    }
    
    #eth-founding-rate .stat-value {
      font-size: 1rem;
    }
    .funding-flash-green {
      width: 65px;
      border-radius: 12px;
      animation: fundingFlashGreen var(--flash-duration);
      display: inline-block;
    }
    
    .funding-flash-red {
      width: 65px;
      border-radius: 12px;
      animation: fundingFlashRed var(--flash-duration);
      display: inline-block;
    }
    
    @keyframes fundingFlashGreen {
      0% { background-color: transparent; }
      50% { background-color: #06f96c33; }
      100% { background-color: transparent; }
    }
    
    @keyframes fundingFlashRed {
      0% { background-color: transparent; }
      50% { background-color: #f1061933; }
      100% { background-color: transparent; }
    }
    #global-marketcap .stat-value, #global-volume .stat-value {
      font-family: 'Courier New', monospace;
      width: 120px;
      text-align: center;
      display: inline-block;
      padding: 2px 5px;
      width: 78px;
      border-radius: 12px;
    }
    
  
    
    
    .market-flash-green {
      width: 65px;
      border-radius: 12px;
      animation: marketFlashGreen var(--flash-duration);
      display: inline-block;
    }
    
    .market-flash-red {
      width: 65px;
      border-radius: 12px;
      animation: marketFlashRed var(--flash-duration);
      display: inline-block;
    }
    
    @keyframes marketFlashGreen {
      0% { background-color: transparent; }
      50% { background-color: #2ed57333; }
      100% { background-color: transparent; }
    }
    
    @keyframes marketFlashRed {
      0% { background-color: transparent; }
      50% { background-color: #ff475733; }
      100% { background-color: transparent; }
    }

    /* Update the sentiment grid to have proper padding and spacing */
.sentiment-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 24px; /* Increased from 16px */
  padding: 0 24px; /* Increased from 16px */
  margin: 24px 0; /* Added top and bottom margin */
  justify-content: center; /* Center the cards */
}

/* Add margin to the section title to align with the grid */
.section-title {
  font-size: 20px;
  font-weight: bold;
  margin: 24px 24px; /* Increased from 16px */
  color: #bab7b7;
}

/* Add margin to the stat-card for fear-greed */
.stat-card#fear-greed {
  margin: 20px auto; /* Center the card and add vertical spacing */
  width: 220px; /* Slightly wider */
}

/* Add margin to the global-stats-container */
.global-stats-container {
  width: 100%;
  margin: 24px auto; /* Added top and bottom margin */
  display: flex;
  flex-direction: column;
  gap: 20px; /* Increased from 15px */
  padding: 0 24px; /* Increased from 16px */
}

/* Trending Cards - Adding spacing from edges */
.trending { 
  margin: 2rem 0; 
  padding: 0 15px; /* Added padding on left and right */
}

.trending-container {
  display: grid; 
  grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  gap: 1.5rem;
  margin: 0 200px; /* Added margin on left and right */
}

.trending-card {
  background: transparent;
  color: var(--text-primaryrgb);
  padding: 15px; /* Increased from 10px */
  width: 209px;
  border: 2.5px solid var(--cardbg);
  border-radius: 34px; /* Fixed border radius value */
  margin: 15px; /* Increased from 10px */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Added subtle shadow */
}

/* Add spacing to the section heading for trending */
.section-heading {
  text-align: center; /* Center the text within the element */
  margin-bottom: 2.5rem;
  font-size: 17px;
  font-weight: bold;
  margin-left: auto; /* Changed from 200px to auto */
  margin-right: auto; /* Added auto margin on right side */
  padding: 8px 530px; /* Added padding for button-like appearance */
  border: 2px solid var(--cardbg); /* Added border to match stat cards */
  border-radius: 34px; /* Added rounded corners like stat cards */
  display: block; /* Changed from inline-block to block */
  width: fit-content; /* Make it only as wide as needed */
  background: transparent; /* Ensures background is transparent */
  color: var(--text-secondary); /* Makes text color match stat card titles */
}

/* Add spacing to sorting buttons */
.sorting-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 10px; /* Keep only the bottom margin */
  margin-left: auto;
  margin-right: auto;
  margin-top: 0; /* Reset top margin */
  width: fit-content;
  padding-left: 15px;
}


   
    

.btc-header {
  position: absolute;
  top: 5px;
  left: 10px;  /* Changed from right to left */
  z-index: 2;
  display: flex;
  align-items: center;
  gap: 4px;
}

#btc-dominance .stat-value {
  position: absolute;
  top: 10%;
  right: 15px;  /* Changed from left to right */
  transform: translate(0, -50%);
  color: #d6ac83;
  font-size: 13px;
  font-weight: bold;
  z-index: 2;
}

    
    .btc-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
    }
    
    .btc-name {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .chart-container {
  height: 91px;
  width: 100%;
  margin-top: 25px;
}
    
    #btc-dom-chart {
      max-height: 80px;
    }
    
    .trending-chart canvas {
      width: 195px !important;
      height: 60px !important;
    }
     
    

    .shaking { animation: shake 0.5s infinite; }
    .plus-button {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #fff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
      cursor: pointer;
      display: none;
      color: black;
      border: 1px solid #ccc;
    }
    .card-container { position: relative; }
    .trending-card {
      background: transparent ;
      color: var(--text-primaryrgb);
      padding: 10px;
      width: 209px;
      border: 2.5px solid var(--cardbg);
      border-radius: px;
      margin: 10px;
    }
    /* Fee Tracker Section Styles */
    #fee-tracker {
      width: fit-content;
      align-items: center;
      font-size: 12px;
      font-weight: boldrem;
      font-style: italic;
      color: var(--text-primary);
      border: 1px solid var(--text-primary);
      border-radius:345px;
      padding: 0.5rem 1.5rem;
      margin: 1rem 2rem;
    }
    #fee-tracker span {
      margin-right: 10px;
    }
    .section-title {
      font-size: 20px;
      font-weight: bold;
      margin: 16px;
      color: #bab7b7;
    }

    .sentiment-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      padding: 0 16px;
      margin-bottom: 24px;
    }

    .sentiment-card {
  flex: 1;
  min-width: 250px;  /* Reduced from 300px */
  max-width: 250px;  /* Added max-width */
  height: 250px;    /* Changed from 300px to match width */
  border-radius: 24px;
  padding: 16px;
  border: 2px solid #707273;
}

    .card-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 16px;
      color: #f6db79;
    }

    /* Fear & Greed Gauge */
    .fear-greed-gauge {
  background-color: #3d3d3a;
  border-radius: 24px;
  padding: 16px;
  text-align: center;
  position: relative;
  width: 250px;  /* Reduced width */
  height: 250px; /* Made it square */
  overflow: hidden;
}


.gauge-container {
  position: relative;
  height: 200px;  /* Reduced height */
  width: 200px;   /* Made it square */
  margin: 0 auto;
  background: transparent;
  overflow: hidden;
  border-radius: 10px;  /* Reduced border radius for more square look */
}

.gauge-background {
  position: absolute;
  width: 95%;  /* Reduced from 100% to prevent overflow */
  height: 95%;  /* Reduced from 100% to prevent overflow */
  top: 2.5%;   /* Center the gauge */
  left: 2.5%;  /* Center the gauge */
  border: 5px solid transparent;
  border-radius: 250px 250px 0 0;
  border-bottom: 0;
  // ... rest of the properties remain the same
}
gauge-container {
  position: relative;
  height: 200px;
  width: 350px;
  margin: 0 auto;
  background: transparent;
  overflow: hidden;  /* Ensure content stays within bounds */
  border-radius: 175px 175px 0 0;
}

    .gauge-container {
  position: relative;
  height: 150px;  /* Increased from 120px */
  margin: 0 auto;
  background: transparent;
  overflow: hidden;
  border-radius: 50px 50px 0 0;
}

    .gauge-background {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }

    .gauge-labels {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 20px;
    }

    .gauge-label {
      position: absolute;
      font-size: 12px;
      color: #d2f59e;
    }

    .label-strong-sell {
      bottom: 0;
      left: 0;
    }

    .label-sell {
      top: 40%;
      left: 20%;
    }

    .label-neutral {
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
    }

    .label-buy {
      top: 40%;
      right: 20%;
    }
    .gauge-background {
  position: absolute;
  width: 55%;  /* Reduced from 90% to squeeze inward more */
  height: 85%;  /* Reduced from 90% to squeeze inward more */
  top: 7.5%;   /* Increased from 5% to center the smaller gauge */
  left: 20%;  /* Increased from 5% to center the smaller gauge */
  border: 5px solid transparent;
  border-radius: 250px 250px 0 0;
  border-bottom: 0;
  background-image: linear-gradient(var(--primary-bg), var(--primary-bg)),
    repeating-linear-gradient(90deg,
      #FF0000 0% 17%,    /* Red segment */
      transparent 17% 17.5%,
      
      transparent 20.5% 21%,
      #FFA500 21% 37%,   /* Orange segment */
      transparent 37% 37.5%,
      
      transparent 40.5% 41%,
      #FFFF00 41% 57%,   /* Yellow segment */
      transparent 57% 57.5%,
     
      transparent 60.5% 61%,
      #90EE90 61% 77%,   /* Light green segment */
      transparent 77% 77.5%,
      
      transparent 80.5% 81%,
      #008000 81% 100%   /* Dark green segment */
    );
  background-origin: border-box;
  background-clip: padding-box, border-box;
  opacity: 0.8;
}

.gauge-container {
  position: relative;
  height: 120px;
  margin: 0 auto;
  background: transparent;
  overflow: hidden;
  border-radius: 150px 150px 0 0;
  
}

.indicator-triangle {
  width: 0;
  height: 0;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 6px solid #ffffff;  /* Changed to white for better visibility */
  position: absolute;
  bottom: -6px;
  left: 4px;
  z-index: 2;
}

    .label-strong-buy {
      bottom: 0;
      right: 0;
    }

    .gauge-needle {
      position: absolute;
      bottom: 0;
      left: 50%;
      height: 80px;
      width: 2px;
      background-color: #ffffff;
      transform-origin: bottom center;
      transform: rotate(0deg);
      transition: transform 1s ease;
    }

    .gauge-needle::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: -5px;
      width: 12px;
      height: 12px;
      background-color: #767673;
      border-radius: 50%;
    }

    .gauge-classification {
      font-size: 16px;
      font-weight: bold;
      margin-top: 8px;
    }

    .gauge-value {
      position: absolute;
      bottom: 5px;
      right: 9px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: var( --text-secondary);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 14px;
      font-weight: bold;
      color: var( --accent-blue)
    }
    .separator {
      margin: 0 10px;
      color: var(--text-secondary);
    }
   
    
    .sorting-buttons button {
      background: var(--accent-theme);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
      font-weight: bold;
      font-size: 19
    }
    .sorting-buttons button:hover {
      background: #2a2d30;
      transform: translateY(-px);
      
    }
    .price-range {
      background-color: #2a2a2a;
      border-radius: 24px;
      padding: 16px;
    }

    .range-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 16px;
      color: #bab7b7;
    }

    .range-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .range-value {
      font-size: 12px;
      width: 70px;
      color: #bab7b7;
    }

    .range-bar {
      flex: 1;
      height: 8px;
      border-radius: 4px;
      margin: 0 8px;
      position: relative;
      background-color: rgba(246, 219, 121, 0.3);
    }

    .range-indicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      position: absolute;
      top: -4px;
      background-color: #f6db79;
      transform: translateX(-50%);
    }

    .indicator-triangle {
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 6px solid #e3d9d9;
      position: absolute;
      bottom: -6px;
      left: 4px;
    }

    .current-price {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-top: 8px;
      color: #f6db79;
    }

    /* Chart Type Selector Styles */
.chart-type-selector {
  display: flex;
  justify-content: center;
  margin-top: 1rem;
  margin-bottom: 1rem;
}

.chart-type-btn {
  background-color: #333;
  color: white;
  border: none;
  padding: 10px 20px;
  margin: 0 5px;
  border-radius: 34px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
}

.chart-type-btn:hover {
  background-color: #444;
  transform: translateY(-2px);
  border: 2px solid var(--buttonbg); /* This adds the yellow border on hover */
}

.chart-type-btn.active {
  background-color: #395143;
  color: #ede8e8;
  box-shadow: 0 4px 12px rgba(46, 213, 115, 0.2);
}
/* Add these new styles */
.range-chart-container {
  margin-top: 15px;
  height: 60px;
  width: 100%;
}

/* Add these new styles for the global stats container */
/* Global Stats Container Styles */
.global-stats-container {
  width: 100%;
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  gap: 15px;
  padding: 0 16px;
}

/* Row Styles - Fix the grid layout */
.global-stats-row {
  display: grid;
  grid-template-columns: 1fr 1fr; /* Two equal columns */
  gap: 15px;
  width: 100%;
  margin-bottom: 15px;
}


/* Make sure the BTC dominance row is full width */
.global-stats-row:last-child {
  grid-template-columns: 1fr; /* Full width for BTC dominance */
}
  
    /* Funding Row - Special Grid Layout */
    .funding-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
  
    /* Card Styles */
    .global-stat-card {
  background: transparent;
  border-radius: 15px;
  padding: 15px;
  position: relative;
  border: 2.5px solid var(--cardbg);
  height: 100%;
  width: 100%;
  min-height: 80px;
}
  
    /* Market Cap & Volume Styles */
    #global-marketcap, 
    #global-volume {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
  
    /* BTC Dominance Chart Styles */
    #btc-dominance {
  min-height: 150px;
  height: auto;
  width: 100%;
  padding: 15px;
}
  
    /* BTC Dominance Header */
    .btc-header {
      position: absolute;
      top: 5px;
      left: 10px;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 4px;
    }
  
    #btc-dominance .stat-value {
      position: absolute;
      top: 10%;
      right: 15px;
      transform: translate(0, -50%);
      color: #d6ac83;
      font-size: 13px;
      font-weight: bold;
      z-index: 2;
    }
  
    #btc-dominance .chart-container {
      height: 91px;
      width: 100%;
      margin-top: 25px;
    }
  
    /* Funding Rates Styles */
    #btc-founding-rate,
    #eth-founding-rate {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px;
    }
  
    /* Responsive adjustments */
@@media (max-width: 768px) {
  .global-stats-row {
    grid-template-columns: 1fr; /* Stack on mobile */
  }
}

/* Add margin to the section title to align with the grid */
.section-title {
  font-size: 20px;
  font-weight: bold;
  margin: 30px 30px; /* Changed from 24px 24px to match other headings */
  padding-left: 15px; /* Added padding to match other headings */
  color: #bab7b7;
}

/* Update the sentiment grid to have proper padding and spacing */
.sentiment-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 24px; /* Increased from 16px */
  padding: 0 45px; /* Increased from 24px to match other sections */
  margin: 30px 0; /* Added top and bottom margin */
  justify-content: center; /* Center the cards */
}
 
  
    /* Flash Update Animations */
    .flash-green { animation: flashGreen var(--flash-duration); }
    .flash-red { animation: flashRed var(--flash-duration); }
    @keyframes flashGreen { 0% { background-color: transparent; } 50% { background-color: #2ed57333; } 100% { background-color: transparent; } }
    @keyframes flashRed { 0% { background-color: transparent; } 50% { background-color: #ff475733; } 100% { background-color: transparent; } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
  <div id="preloader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; backdrop-filter: blur(10px); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999;">
    <img src="logoj.png" alt="Logo" class="expanding-logo">
    <div class="spinner"></div>
    <div class="small-loader"></div>
  </div>
  <header>
    <div class="header-container">
      <div class="header-left">
        <div class="brand">
          <img src="logoj.png" alt="Platone Logo" class="brand-logo" />
          <div style="font-weight:bold">Platone </div>
        </div>
      </div>
      <div class="header-center">
        <nav>
          <a href="#trending" class="button">Cryptocurrencies</a>
          <a href="#" class="button">DeepCharts</a>
          <a href="#" class="button">ETF</a>
          <a href="#" class="button">NEWS</a>
          <a href="#" class="button">Products</a>
        </nav>
      </div>
      <div class="header-right">
        <input type="text" placeholder="Search..." class="search-bar" />
        <a href="#" class="button">Log In</a>
        <!-- Theme Toggle Switch with Moon/Sun icons -->
        <label class="theme-switch">
          <input type="checkbox" id="themeSwitch">
          <div class="switch-track">
            <span class="switch-option option-dark">
              <i class="fas fa-moon"></i>
            </span>
            <span class="switch-option option-light">
              <i class="fas fa-sun"></i>
            </span>
            <div class="switch-thumb"></div>
          </div>
        </label>
        <button class="settings-btn" id="settingsBtn"><i class="fas fa-cog"></i></button>
        <div class="settings-menu" id="settingsMenu">
          <button id="profileBtn">Profile</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>
    </div>
  </header>
  <div id="fee-tracker">
    <span>⛽ BTC: $<span id="fee-btc">--</span></span>
    <span class="separator">|</span>
    <span>ETH Gas: $<span id="fee-eth">--</span></span>
  </div>
  <div class="cube"></div>
  <main class="container">
    <!-- Global Stats -->
    <!-- Update the global stats container HTML structure -->
    <div class="global-stats-container">
      <!-- First row: Market Cap and BTC Funding Rate -->
      <div class="global-stats-row">
        <div class="global-stat-card" id="global-marketcap">
          <div class="stat-title">Global Market Cap</div>
          <div class="stat-loading">Loading...</div>
          <div class="stat-value" style="display: none;"></div>
        </div>
        
        <div class="global-stat-card" id="btc-founding-rate">
          <h3>BTC Funding Rate</h3>
          <div class="stat-loading">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
          <p class="stat-value founding-rate" style="display:none; color: var(--cardbg)"></p>
        </div>
      </div>
      
      <!-- Second row: 24h Volume and ETH Funding Rate -->
      <div class="global-stats-row">
        <div class="global-stat-card" id="global-volume">
          <div class="stat-title">24h Volume</div>
          <div class="stat-loading">Loading...</div>
          <div class="stat-value" style="display: none;"></div>
        </div>
        
        <div class="global-stat-card" id="eth-founding-rate">
          <h3>ETH Funding Rate</h3>
          <div class="stat-loading">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
          <p class="stat-value founding-rate" style="display:none; color: var(--cardbg)"></p>
        </div>
      </div>
      
      <!-- Third row: Technical Gauge, Day Range, and BTC Dominance Chart -->
        <!-- Third row: Technical Gauge, Day Range, and BTC Dominance Chart -->
        <div class="global-stats-row" style="grid-template-columns: 1fr 1fr 1fr;">
          <div class="global-stat-card fear-greed-gauge" style="min-height: 150px; padding: 10px; background: transparent; border: 2.5px solid var(--cardbg);">
            <h3 class="gauge-title" style="font-size: 14px; margin-bottom: 5px;text-align: center; ">Fear Index 24H </h3>
            <div class="gauge-container" style="height: 100px; width: 200px;">
              <div class="gauge-background" style="width: 100%; left: 0;"></div>
              <div class="gauge-labels">
                <span class="gauge-label label-strong-sell"></span>
                <span class="gauge-label label-sell"></span>
                <span class="gauge-label label-neutral"></span>
                <span class="gauge-label label-buy"></span>
                <span class="gauge-label label-strong-buy"></span>
              </div>
              <div class="gauge-needle" id="gaugeNeedle"></div>
            </div>
            <div class="gauge-classification" id="gaugeClassification" style="font-size: 14px; margin-top: 5px;">Neutral</div>
            <div class="gauge-value" id="gaugeValue" style="font-size: 14px; width: 35px; height: 35px;">50</div>
          </div>
          
  
    
    <div class="global-stat-card price-range" style="background: transparent; border: 2.5px solid var(--cardbg);">
      <h3 class="range-title">Day Range</h3>
      <div class="range-container">
        <span class="range-value" id="dayLow">$--</span>
        <div class="range-bar">
          <div class="range-indicator" id="rangeIndicator" style="left: 50%;">
            <div class="indicator-triangle"></div>
          </div>
        </div>
        <span class="range-value" id="dayHigh">$--</span>
      </div>
      <div class="current-price" id="currentPrice">$--</div>
      <!-- New chart container -->
      <div class="range-chart-container">
        <canvas id="btcRangeChart"></canvas>
      </div>
    </div>
    
    <div class="global-stat-card" id="btc-dominance">
      <div class="btc-header">
        <img src="https://s2.coinmarketcap.com/static/img/coins/64x64/1.png" alt="BTC" class="btc-icon">
        <span class="btc-name">BTC</span>
      </div>
      <div class="stat-loading">
        <span class="dot"></span>
        <span class="dot"></span>
        <span class="dot"></span>
      </div>
      <p class="stat-value" style="display:none;"></p>
      <div class="chart-container">
        <canvas id="btc-dom-chart"></canvas>
      </div>
    </div>
  </div>
</div>
  </main>
      <!-- REMOVE the duplicate funding rates section that was outside the row -->
      
    
    </div>
    <!-- Fee Tracker Section (Left side of Main Body) -->
    <!-- (Additional content can be added here) -->
    <!-- ========== UPDATED COIN DETAIL WINDOW ========= -->
    <div class="coin-details-section" id="coinDetails">
      <span class="close-details" onclick="closeDetails()">×</span>
      <!-- Detail Settings -->
      <button id="detailSettingsBtn" class="settings-btn"><i class="fas fa-cog"></i></button>
      <div id="detailSettingsPanel">
        <h3>Customized</h3>
        <label for="graphColorPicker">Graph Color:</label>
        <input type="color" id="graphColorPicker" value="#2ed573" />
      </div>
      <!-- Header: Coin Info & Buyers/Sellers Widget -->
      <div class="coin-details-header">
        <div class="price-info">
          <img id="detailCoinImg" src="https://s2.coinmarketcap.com/static/img/coins/64x64/1.png" alt="Coin Icon" />
          <div>
            <h2 id="detailCoinName">Bitcoin</h2>
            <div class="current-price" id="detailPrice">$--</div>
          </div>
        </div>
        <!-- Buyers/Sellers Widget -->
        <div class="buyers-sellers-widget">
          <div class="ratio-container">
            <div class="ratio-buyers" id="buyersBar">
              <span id="buyersPercentText">Buyers: --%</span>
            </div>
            <div class="ratio-sellers" id="sellersBar">
              <span id="sellersPercentText">Sellers: --%</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Coin Stats Box -->
      <div class="coin-stats-box">
        <div class="stat-item">
          <span>Market Cap</span>
          <div id="detailMarketCap">Loading...</div>
        </div>
        <div class="stat-item">
          <span>Volume (24h)</span>
          <div id="detailVolume">Loading...</div>
        </div>
        <div class="stat-item">
          <span>FDV</span>
          <div id="detailFDV">Loading...</div>
        </div>
        <div class="stat-item">
          <span>Vol/Mkt Cap (24h)</span>
          <div id="detailVolMktCap">Loading...</div>
        </div>
        <div class="stat-item">
          <span>Total supply</span>
          <div id="detailTotalSupply">Loading...</div>
        </div>
        <div class="stat-item">
          <span>Max. supply</span>
          <div id="detailMaxSupply">Loading...</div>
        </div>
      </div>
      <!-- Timeframe Selector -->
      <div class="timeframe-selector">
        <button class="timeframe-btn active" data-hours="24">24H</button>
        <button class="timeframe-btn" data-hours="168">7D</button>
        <button class="timeframe-btn" data-hours="720">1M</button>
        <button class="timeframe-btn" data-hours="2160">3M</button>
      </div>
      
      <!-- Add after your timeframe-selector div -->
      <div class="chart-type-selector">
        <button class="chart-type-btn" id="lineChartBtn"><i class="fa-solid fa-chart-line"></i></button>
        <button class="chart-type-btn active" id="candlestickChartBtn"><i class="fa fa-bar-chart"></i></button>
         <!-- Chart Container <button class="chart-type-btn" id="advancedChartBtn"><i class="fa fa-bar-chart"></i> Advanced</button>-->
      </div>
      <!-- Chart Container -->
      <div class="detail-chart-container">
        <canvas id="detailChart"></canvas>
      </div>
      <!-- NERD Button -->
      <button class="button" id="nerdBtn" data-symbol="">NERD</button>
       </div>

    <div class="trending" id="trending">
      <h2 class="section-heading">Crypto</h2>
      <div class="sorting-buttons">
        <button id="topGainerBtn">Top Gainer </button>
        <button id="topLoserBtn">Top Loser</button>
      </div>
      <div class="trending-container" id="trending-container">
        <!-- Trending coin cards will be injected here -->
      </div>
    </div>
  </main>
  <script>

    
    /* Global Variables */
    const TIME_LIMIT = 168;
    const circulatingSupply = {
      Bitcoin: 19600000, Ethereum: 120200000, XRP: 54045766079,
      Tether: 83016246102, BNB: 155852912, Solana: 428116287,
      'USD Coin': 25057892805, Dogecoin: 142897336384, Cardano: 35045020830,
      TRON: 88737645165, Sui: 1000000000, Aptos: 1000000000,
      Avalanche: 720000000, Chainlink: 1000000000, Stellar: 50001806812,
      Litecoin: 84000000, Toncoin: 5000000000, ShibaInu: 549063278876301,
      Hedera: 50000000000, Bittensor: 1000000000, Polkadot: 1100000000,
      Mantra: 5000000000, Dai: 5340000000, Uniswap: 753766667,
      Monero: 1038218400, Nearprotocol: 1000000000, Pepe: 420690000000000,
      AAVE: 14720000
    };

    const trendingCoins = [
      { name: 'Bitcoin', id: 1, symbol: 'BTCUSDT' },
      { name: 'Ethereum', id: 1027, symbol: 'ETHUSDT' },
      { name: 'XRP', id: 52, symbol: 'XRPUSDT' },
      { name: 'BNB', id: 1839, symbol: 'BNBUSDT' },
      { name: 'Solana', id: 5426, symbol: 'SOLUSDT' },
      { name: 'Cardano', id: 2010, symbol: 'ADAUSDT' },
      { name: 'Dogecoin', id: 74, symbol: 'DOGEUSDT' },
      { name: 'Sui', id: 20947, symbol: 'SUIUSDT' },
      { name: 'Aptos', id: 21794, symbol: 'APTUSDT' },
      { name: 'Avalanche', id: 5805, symbol: 'AVAXUSDT' },
      { name: 'Tron', id: 1958, symbol: 'TRXUSDT' },
      { name: 'Chainlink', id: 1975, symbol: 'LINKUSDT' },
      { name: 'Stellar', id: 512, symbol: 'XLMUSDT' },
      { name: 'Litecoin', id: 2, symbol: 'LTCUSDT' },
      { name: 'Toncoin', id: 11419, symbol: 'TONUSDT' },
      { name: 'ShibaInu', id: 5994, symbol: 'SHIBUSDT' },
      { name: 'Hedera', id: 4642, symbol: 'HBARUSDT' },
      { name: 'Bittensor', id: 22974, symbol: 'TAOUSDT' },
      { name: 'Polkadot', id: 6636, symbol: 'DOTUSDT' },
      { name: 'Mantra', id: 6536, symbol: 'OMUSDT' },
      { name: 'Dai', id: 4943, symbol: 'DAIUSDT' },
      { name: 'Uniswap', id: 7083, symbol: 'UNIUSDT' },
      { name: 'Monero', id: 328, symbol: 'XMRUSDT' },
      { name: 'Nearprotocol', id: 6535, symbol: 'NEARUSDT' },
      { name: 'Pepe', id: 24478, symbol: 'PEPEUSDT' },
      { name: 'AAVE', id: 7278, symbol: 'AAVEUSDT' },
      // New cryptocurrencies added
      { name: 'VeChain', id: 3077, symbol: 'VETUSDT' },
      { name: 'Filecoin', id: 2280, symbol: 'FILUSDT' },
      { name: 'Internet Computer', id: 8916, symbol: 'ICPUSDT' },
      { name: 'Theta', id: 2416, symbol: 'THETAUSDT' },
      { name: 'EOS', id: 1765, symbol: 'EOSUSDT' },
      { name: 'Algorand', id: 4030, symbol: 'ALGOUSDT' },
      { name: 'ApeCoin', id: 18876, symbol: 'APEUSDT' },
      { name: 'The Graph', id: 6719, symbol: 'GRTUSDT' },
      { name: 'Decentraland', id: 1966, symbol: 'MANAUSDT' },
      { name: 'Bitcoin Cash', id: 1831, symbol: 'BCHUSDT' },
      { name: 'Cosmos', id: 3794, symbol: 'ATOMUSDT' },
      { name: 'NEO', id: 1376, symbol: 'NEOUSDT' },
      { name: 'IOTA', id: 1720, symbol: 'IOTAUSDT' },
      { name: 'Maker', id: 1518, symbol: 'MKRUSDT' },
      { name: 'Compound', id: 5692, symbol: 'COMPUSDT' },
      { name: 'SushiSwap', id: 6758, symbol: 'SUSHIUSDT' },
      { name: 'Zilliqa', id: 2469, symbol: 'ZILUSDT' },
      { name: 'Enjin Coin', id: 2130, symbol: 'ENJUSDT' },
      { name: 'Stacks', id: 4847, symbol: 'STXUSDT' },
      { name: 'Chiliz', id: 4066, symbol: 'CHZUSDT' },
      { name: 'Kusama', id: 5034, symbol: 'KSMUSDT' },
      { name: 'Dash', id: 131, symbol: 'DASHUSDT' },
      { name: 'Zcash', id: 1437, symbol: 'ZECUSDT' },
      { name: 'Nexo', id: 2694, symbol: 'NEXOUSDT' },
      { name: 'PancakeSwap', id: 7186, symbol: 'CAKEUSDT' },
      { name: 'Celo', id: 5567, symbol: 'CELOUSDT' },
      { name: 'OMG Network', id: 1808, symbol: 'OMGUSDT' },
      { name: 'Basic Attention Token', id: 1697, symbol: 'BATUSDT' },
      { name: 'Synthetix', id: 2586, symbol: 'SNXUSDT' },
      { name: 'Curve DAO Token', id: 6538, symbol: 'CRVUSDT' },
      { name: 'Terra Classic', id: 4172, symbol: 'LUNCUSDT' },


    ];
    

    const trendingContainer = document.getElementById('trending-container');
    const trendingCardsMap = {};
    let currentDetailCoin = null;
    let detailChartInstance = null;
    let currentTimeframe = 168; // default 7 days
    let detailChartColor = "#2ed573";
    let currentCoinPrice = 0;

    // Initialize Trending Coin Cards
    trendingCoins.forEach((coin, index) => {
      const card = document.createElement('div');
      let longPressTriggered = false;
      let pressTimer;
      card.addEventListener('mousedown', () => {
        longPressTriggered = false;
        pressTimer = setTimeout(() => {
          longPressTriggered = true;
          card.classList.add('shaking');
          plus.style.display = 'flex';
        }, 300);
      });
      card.addEventListener('mouseup', () => {
        clearTimeout(pressTimer);
        setTimeout(() => { longPressTriggered = false; }, 50);
      });
      card.className = 'trending-card';
      card.setAttribute('data-coin', coin.name);
      card.innerHTML = `
        <div class="trending-header">
          <img src="https://s2.coinmarketcap.com/static/img/coins/64x64/${coin.id}.png" alt="${coin.name}">
          <span>${coin.name}</span>
        </div>
        <div class="trending-details">
          <div>Price: <strong class="trending-price" data-prev="0">--</strong></div>
          <div>7d: <strong class="trending-7d" data-prev="0">--</strong></div>
          <div>Market Cap: <strong class="trending-marketcap" data-prev="0">--</strong></div>
        </div>
        <div class="trending-chart">
          <canvas id="trending-chart-${index}" width="200" height="100"></canvas>
        </div>
      `;
      trendingContainer.appendChild(card);
      trendingCardsMap[coin.name] = card;
      card.addEventListener('click', function(e) {
        if (longPressTriggered) {
          e.preventDefault();
          return;
        }
        openDetails(coin.name);
      });
      const ctx = document.getElementById(`trending-chart-${index}`).getContext('2d');
      fetchHistoricalData(coin.symbol, 168, false).then(data => {
        const color = data.length && (typeof data[0] === 'object' ? data[data.length - 1].c >= data[0].c : data[data.length - 1] >= data[0]) ? '#2ed573' : '#ff4757';
        initChart(ctx, data, color);
      });
    });

    function formatCurrency(value) {
  const absValue = Math.abs(value);
  if (absValue >= 1e12) {
    return `$${(value / 1e12).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}T`;
  }
  if (absValue >= 1e9) {
    return `$${(value / 1e9).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}B`;
  }
  if (absValue >= 1e6) {
    return `$${(value / 1e6).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}M`;
  }
  if (absValue >= 1e3) {
    return `$${(value / 1e3).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}K`;
  }
  return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}

    function flashUpdate(element, newVal, oldVal) {
      if (newVal > oldVal) { element.classList.add('flash-green'); }
      else if (newVal < oldVal) { element.classList.add('flash-red'); }
      setTimeout(() => { element.classList.remove('flash-green', 'flash-red'); }, 800);
    }

    async function fetchHistoricalData(symbol, hours = 168) {
      // Dynamic interval selection based on timeframe
      let interval;
      if (hours === 24) {
        interval = '5m';  // 5-minute intervals for 24h (288 data points)
      } else if (hours === 168) {
        interval = '30m';  // 30-minute intervals for 7d (336 data points)
      } else if (hours === 720) {
        interval = '2h';   // 2-hour intervals for 1M (360 data points)
      } else if (hours === 2160) {
        interval = '6h';   // 6-hour intervals for 3M (360 data points)
      }
    
      const limit = Math.ceil(hours * 60 / parseInt(interval));
      const endpoint = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
      
      try {
        const response = await fetch(endpoint);
        const data = await response.json();
        return data.map(entry => parseFloat(entry[4]));
      } catch (error) {
        console.error('Error fetching historical data:', error);
        return [];
      }
    }
    

    function initChart(ctx, data, color) {
      // This is specifically for trending cards' small charts
      return new Chart(ctx, {
          type: 'line',
          data: {
              labels: Array(data.length).fill(''),
              datasets: [{
                  data: data.map(d => typeof d === 'object' ? d.c : d), // Handle both data formats
                  borderColor: color,
                  borderWidth: 2,
                  pointRadius: 0,
                  tension: 0.2,
                  fill: false
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: { 
                  x: { display: false }, 
                  y: { display: false } 
              },
              plugins: { 
                  legend: { display: false }, 
                  tooltip: { enabled: false } 
              }
          }
      });
  }
    
    async function updateDetailChart(hours) {
      if (!currentDetailCoin) return;
      const coin = trendingCoins.find(c => c.name === currentDetailCoin);
      if (!coin) return;

      document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.hours == hours) btn.classList.add('active');
      });

      const data = await fetchHistoricalData(coin.symbol, hours);
      if (!data.length) return;

      const ctx = document.getElementById('detailChart').getContext('2d');
      if (detailChartInstance) detailChartInstance.destroy();

      detailChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map((_, i) => i),
          datasets: [{
            data: data,
            borderColor: detailChartColor,
            borderWidth: 2,
            pointRadius: 0,
            tension: 0.2,
            fill: false
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { x: { display: false }, y: { display: false } },
          plugins: { legend: { display: false }, tooltip: { enabled: false } }
        }
      });
      
      updateBuyersSellers(data);
    }

    // Calculate and update buyers/sellers percentages
    function updateBuyersSellers(data) {
      if (!data || data.length < 2) return;
      const firstPrice = data[0];
      const lastPrice = data[data.length - 1];
      const diff = ((lastPrice - firstPrice) / firstPrice) * 100;
      const factor = 0.5;
      let buyers = 50 + diff * factor;
      buyers = Math.max(0, Math.min(100, buyers));
      const sellers = 100 - buyers;
      updateBuyersSellersUI(buyers, sellers);
    }

    function updateBuyersSellersUI(buyers, sellers) {
      const buyersBar = document.getElementById('buyersBar');
      const sellersBar = document.getElementById('sellersBar');
      buyersBar.style.width = buyers + "%";
      sellersBar.style.width = sellers + "%";
      document.getElementById('buyersPercentText').textContent = "Buyers: " + buyers.toFixed(0) + "%";
      document.getElementById('sellersPercentText').textContent = "Sellers: " + sellers.toFixed(0) + "%";
    }

    // Update coin stats in the stats box.
    function updateCoinStats(coin, price) {
      const supply = circulatingSupply[coin] || 1000000;
      const marketCap = price * supply;
      document.getElementById('detailMarketCap').textContent = formatCurrency(marketCap);
      document.getElementById('detailVolume').textContent = "N/A";
      document.getElementById('detailFDV').textContent = "N/A";
      document.getElementById('detailVolMktCap').textContent = "N/A";
      document.getElementById('detailTotalSupply').textContent = supply.toLocaleString();
      document.getElementById('detailMaxSupply').textContent = "N/A";
    }

    async function openDetails(coinName) {
      const detailSection = document.getElementById('coinDetails');
      detailSection.style.display = 'block';
      currentDetailCoin = coinName;
      
      // Update coin image and NERD button symbol
      const coinData = trendingCoins.find(c => c.name === coinName);
      if(coinData) {
        document.getElementById('detailCoinImg').src = `https://s2.coinmarketcap.com/static/img/coins/64x64/${coinData.id}.png`;
        document.getElementById('nerdBtn').setAttribute('data-symbol', coinData.symbol);
      }
      
      document.getElementById('detailCoinName').textContent = coinName;
      detailSection.scrollIntoView({ behavior: 'smooth' });
      updateDetailChart(currentTimeframe);
    }
    function closeDetails() {
      document.getElementById('coinDetails').style.display = 'none';
      currentDetailCoin = null;
      if (detailChartInstance) {
        detailChartInstance.destroy();
        detailChartInstance = null;
      }
    }

    document.querySelectorAll('.timeframe-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        currentTimeframe = parseInt(btn.dataset.hours);
        updateDetailChart(currentTimeframe);
      });
    });

    // Settings button functionality for coin details
    document.getElementById('detailSettingsBtn').addEventListener('click', function(e) {
      e.stopPropagation();
      this.classList.toggle('rotated');
      const panel = document.getElementById('detailSettingsPanel');
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    });

    // NERD button redirect functionality
    document.getElementById('nerdBtn').addEventListener('click', function() {
      const symbol = this.getAttribute('data-symbol');
      if (symbol) {
          window.location.href = `geek.html?symbol=${symbol}`;
      } else {
          window.location.href = 'geek.html';
      }
    });

    document.getElementById('graphColorPicker').addEventListener('input', function() {
      detailChartColor = this.value;
      if (detailChartInstance) {
        detailChartInstance.data.datasets[0].borderColor = detailChartColor;
        detailChartInstance.update();
      }
    });

    // Theme switch functionality (toggle between dark and light)
    document.getElementById('themeSwitch').addEventListener('change', function() {
      if (this.checked) {
        document.body.classList.add('light-theme');
      } else {
        document.body.classList.remove('light-theme');
      }
    });

    

    const ws = new WebSocket('wss://stream.binance.com:9443/ws/!ticker@arr');
    ws.onmessage = function (event) {
      const data = JSON.parse(event.data);
      data.forEach((ticker) => {
        const symbol = ticker.s;
        const coin = trendingCoins.find((c) => c.symbol === symbol)?.name;
        if (coin && trendingCardsMap[coin]) {
          const card = trendingCardsMap[coin];
          const price = parseFloat(ticker.c);
          const change7d = parseFloat(ticker.P);
          const marketCap = price * (circulatingSupply[coin] || 1000000);

          const priceEl = card.querySelector('.trending-price');
          const oldPrice = parseFloat(priceEl.getAttribute('data-prev')) || 0;
          priceEl.textContent = formatCurrency(price);
          flashUpdate(priceEl, price, oldPrice);
          priceEl.setAttribute('data-prev', price);

          const changeEl = card.querySelector('.trending-7d');
          changeEl.textContent = `${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%`;
          changeEl.className = `trending-7d ${change7d >= 0 ? 'positive' : 'negative'}`;

          const marketCapEl = card.querySelector('.trending-marketcap');
          // Use formatAbbreviatedCurrency instead of formatCurrency
          marketCapEl.textContent = formatAbbreviatedCurrency(marketCap);

          if (currentDetailCoin === coin) {
            document.getElementById('detailPrice').textContent = formatCurrency(price);
            currentCoinPrice = price;
            updateCoinStats(coin, price);
          }
        }
      });
    };

    window.addEventListener('load', function() {
      setTimeout(function() {
        document.getElementById('preloader').style.display = 'none';
      }, 1000);
    });
    // Add this new JavaScript code
// Add this after your existing WebSocket connections
const btcRangeSocket = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@kline_1m');
let btcRangeChartInstance = null;
let btcRangePrices = Array(1440).fill(0); // Store 24 hours of 1-minute data

// Initialize the range chart with historical data
async function initBTCRangeChart() {
  try {
    const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=1440');
    const data = await response.json();
    btcRangePrices = data.map(candle => parseFloat(candle[4]));
    updateBTCRangeChart();
  } catch (error) {
    console.error('Error fetching BTC range data:', error);
  }
}

// Update the chart with new data
function updateBTCRangeChart() {
  const ctx = document.getElementById('btcRangeChart');
  if (!ctx) return;

  if (btcRangeChartInstance) {
    btcRangeChartInstance.destroy();
  }

  btcRangeChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array(btcRangePrices.length).fill(''),
      datasets: [{
        data: btcRangePrices,
        borderColor: '#2ed573',
        borderWidth: 2,
        pointRadius: 0,
        tension: 1,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: { x: { display: false }, y: { display: false } },
      plugins: { legend: { display: false }, tooltip: { enabled: false } },
      animation: { duration: 0 }
    }
  });
}

// Handle WebSocket messages for real-time updates
btcRangeSocket.onmessage = function(event) {
  const data = JSON.parse(event.data);
  if (data.k) {
    const closePrice = parseFloat(data.k.c);
    btcRangePrices.push(closePrice);
    btcRangePrices.shift();
    updateBTCRangeChart();
  }
};

// Initialize when the page loads
document.addEventListener('DOMContentLoaded', function() {
  initBTCRangeChart();
  // Update every 3 minutes
  setInterval(initBTCRangeChart, 180000);
});

    // Add this variable at the top with other global variables
let globalMarketCapValue = 0;

async function updateGlobalStats() {
  try {
    const response = await fetch('https://api.coingecko.com/api/v3/global');
    const data = await response.json();
    const marketCapUsd = data.data.total_market_cap.usd;
    globalMarketCapValue = marketCapUsd;
    const volumeUsd = data.data.total_volume.usd;
    // Add this line to properly get the BTC dominance value
    const btcDominance = data.data.market_cap_percentage.btc;
    
    // Global Market Cap - abbreviated format
    const marketCapCard = document.getElementById('global-marketcap');
    marketCapCard.querySelector('.stat-loading').style.display = 'none';
    const marketCapValue = marketCapCard.querySelector('.stat-value');
    marketCapValue.textContent = formatAbbreviatedCurrency(marketCapUsd);
    marketCapValue.style.display = 'block';
    
    // 24h Volume - abbreviated format
    const volumeCard = document.getElementById('global-volume');
    volumeCard.querySelector('.stat-loading').style.display = 'none';
    const volumeValue = volumeCard.querySelector('.stat-value');
    volumeValue.textContent = formatAbbreviatedCurrency(volumeUsd);
    volumeValue.style.display = 'block';
    
    // Bitcoin Dominance
    const btcCard = document.getElementById('btc-dominance');
    btcCard.querySelector('.stat-loading').style.display = 'none';
    const btcValue = btcCard.querySelector('.stat-value');
    btcValue.textContent = btcDominance.toFixed(2) + '%';
    btcValue.style.display = 'block';
    
  } catch (error) {
    console.error('Error updating global market data:', error);
  }
}
function formatAbbreviatedCurrency(value) {
  if (value >= 1e12) {
    return '$' + (value / 1e12).toFixed(2) + 'T';
  }
  if (value >= 1e9) {
    return '$' + (value / 1e9).toFixed(2) + 'B';
  }
  if (value >= 1e6) {
    return '$' + (value / 1e6).toFixed(2) + 'M';
  }
  if (value >= 1e3) {
    return '$' + (value / 1e3).toFixed(2) + 'K';
  }
  return '$' + value.toFixed(2);
}
    

    async function updateFearGreed() {
      try {
        const response = await fetch('https://api.alternative.me/fng/?limit=1');
        const data = await response.json();
        if (data.data && data.data.length > 0) {
          const indexData = data.data[0];
          const value = indexData.value;
          const classification = indexData.value_classification;
          
          const fgCard = document.getElementById('fear-greed');
          fgCard.querySelector('.stat-loading').style.display = 'none';
          const fgValue = fgCard.querySelector('.stat-value');
          fgValue.innerHTML = `${value} - ${classification}`;
          fgValue.style.display = 'block';
        }
      } catch (error) {
        console.error('Error updating Fear & Greed index:', error);
      }
    }
    
    updateGlobalStats();
    updateFearGreed();
    setInterval(() => { updateGlobalStats(); updateFearGreed(); }, 60000);

    const settingsBtn = document.getElementById('settingsBtn');
    const settingsMenu = document.getElementById('settingsMenu');

    settingsBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      settingsBtn.classList.toggle('active');
      settingsMenu.style.display = (settingsMenu.style.display === 'flex') ? 'none' : 'flex';
    });

    window.addEventListener('click', function (e) {
      if (!settingsMenu.contains(e.target) && !settingsBtn.contains(e.target)) {
        settingsMenu.style.display = 'none';
        settingsBtn.classList.remove('active');
      }
    });

    /* shaking animation */
    document.querySelectorAll('.trending-card').forEach(card => {
      let pressTimer;
      card.classList.add('card-container');
      const plus = document.createElement('div');
      plus.className = 'plus-button';
      plus.textContent = '+';
      card.appendChild(plus);
      card.addEventListener('mousedown', function(e) {
        pressTimer = setTimeout(() => {
          card.classList.add('shaking');
          plus.style.display = 'flex';
        }, 600);
      });
      card.addEventListener('mouseup', function(e) { clearTimeout(pressTimer); });
      card.addEventListener('mouseleave', function(e) { clearTimeout(pressTimer); });
      plus.addEventListener('click', function(e) {
        card.classList.remove('shaking');
        plus.style.display = 'none';
        e.stopPropagation();
      });
    });
    
    async function fetchFees() {
      // --- BTC Fee ---
      let btcFeeData;
      try {
        const response = await fetch('https://mempool.space/api/v1/fees/recommended');
        btcFeeData = await response.json();
      } catch (error) {
        btcFeeData = { fastestFee: 10 }; // fallback in sat/vB
      }
      const btcFeeSat = btcFeeData.fastestFee || 10;
      
      // --- ETH Fee ---
      let ethFeeData;
      try {
        const response = await fetch('https://www.etherchain.org/api/gasPriceOracle');
        ethFeeData = await response.json();
      } catch (error) {
        ethFeeData = { standard: 50 }; // fallback in Gwei
      }
      const ethGasGwei = ethFeeData.standard || 50;
      
      // --- Fetch Live Prices from CoinGecko for BTC and ETH ---
      let priceData;
      try {
        const response = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=usd");
        priceData = await response.json();
      } catch (error) {
        priceData = {
          bitcoin: { usd: 85000 },
          ethereum: { usd: 2400 }
        };
      }
      const btcPrice = priceData.bitcoin.usd;
      const ethPrice = priceData.ethereum.usd;
      
      // --- Fee Calculations in USD ---
      const btcFeeBTC = (btcFeeSat * 250) / 100000000;
      const btcFeeUSD = btcFeeBTC * btcPrice;
      const ethFeeETH = (ethGasGwei * 21000) / 1e9;
      const ethFeeUSD = ethFeeETH * ethPrice;
      
      return {
        BTC: btcFeeUSD.toFixed(2),
        ETH: ethFeeUSD.toFixed(2)
      };
    }
    
     // Existing fee tracker code
     async function updateFeeTracker() {
      const fees = await fetchFees();
      document.getElementById("fee-btc").textContent = fees.BTC;
      document.getElementById("fee-eth").textContent = fees.ETH;
    }
    
    updateFeeTracker();
    setInterval(updateFeeTracker, 60000);
    

 // Add these at the top with other global variables

 // Create combined WebSocket streams

 // Live-update Fear & Greed Gauge using recursive fetch.
// Ensure your HTML contains elements with these IDs:
// "gaugeNeedle" (the needle), "gaugeClassification" (the text label),
// and "gaugeValue" (the numeric display).

function liveUpdateFearGreedGauge() {
  fetch('https://api.alternative.me/fng/')
    .then(response => response.json())
    .then(data => {
      if (data.data && data.data.length > 0) {
        const value = parseInt(data.data[0].value);
        const classification = data.data[0].value_classification;
        const gaugeNeedle = document.getElementById('gaugeNeedle');
        const gaugeClassification = document.getElementById('gaugeClassification');
        const gaugeValue = document.getElementById('gaugeValue');
        // Rotate the needle: 0 maps to -90deg, 100 maps to +90deg
        const angle = -90 + (value / 100) * 180;
        if (gaugeNeedle) {
          gaugeNeedle.style.transform = `rotate(${angle}deg)`;
        }
        if (gaugeClassification) {
          gaugeClassification.textContent = classification;
          // Set text color based on value thresholds:
          if (value <= 25) gaugeClassification.style.color = '#ff4757';    // Extreme Fear
          else if (value <= 45) gaugeClassification.style.color = '#ff7f50'; // Fear
          else if (value <= 55) gaugeClassification.style.color = '#ffa500'; // Neutral
          else if (value <= 75) gaugeClassification.style.color = '#7bed9f'; // Greed
          else gaugeClassification.style.color = '#2ed573';               // Extreme Greed
        }
        if (gaugeValue) {
          gaugeValue.textContent = value;
        }
      }
    })
    .catch(error => {
      console.error("Error updating Fear & Greed gauge:", error);
    })
    .finally(() => {
      // Immediately call the function again after 10 seconds for live updates.
      setTimeout(liveUpdateFearGreedGauge, 10000);
    });
}

// Start live updates for the Fear & Greed gauge.
liveUpdateFearGreedGauge();


// Format a number as USD currency.
function formatCurrency(value, fractionDigits = 2) {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: fractionDigits,
    maximumFractionDigits: fractionDigits
  }).format(value);
}

// Create a WebSocket to Binance's BTCUSDT ticker stream.
const btcTickerSocket = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');

// Listen for live messages.
btcTickerSocket.onmessage = function (event) {
  try {
    const data = JSON.parse(event.data);
    // Ensure we have the proper ticker data for BTCUSDT.
    if (data && data.s === "BTCUSDT") {
      const currentPrice = parseFloat(data.c);
      const dayHigh = parseFloat(data.h);
      const dayLow = parseFloat(data.l);

      // Update DOM elements.
      const currentPriceEl = document.getElementById('currentPrice');
      const dayLowEl = document.getElementById('dayLow');
      const dayHighEl = document.getElementById('dayHigh');
      const rangeIndicatorEl = document.getElementById('rangeIndicator');

      if (currentPriceEl) {
        currentPriceEl.textContent = formatCurrency(currentPrice);
        const midPoint = (dayHigh + dayLow) / 2;
        currentPriceEl.style.color = currentPrice >= midPoint ? '#4cd137' : '#e84118';
      }
      if (dayLowEl) {
        dayLowEl.textContent = formatCurrency(dayLow, 0);
      }
      if (dayHighEl) {
        dayHighEl.textContent = formatCurrency(dayHigh, 0);
      }

      // Calculate and update the range indicator position.
      const range = dayHigh - dayLow;
      let posPercent = 50; // default if range is 0
      if (range > 0) {
        posPercent = ((currentPrice - dayLow) / range) * 100;
        posPercent = Math.min(100, Math.max(0, posPercent));
      }
      if (rangeIndicatorEl) {
        rangeIndicatorEl.style.left = posPercent + '%';
      }
    }
  } catch (error) {
    console.error("Error processing Binance ticker data:", error);
  }
};


// Call this function to update the price change data
// updatePriceChange();


// Call this function to update the Fear and Greed Index
// updateFearGreedIndex();

 let btcDomChart = null;
 let priceData = [];
 
 async function initBTCDominance() {
  // Initial data fetch and chart update
  async function fetchAndUpdateDominance() {
    const response = await fetch('https://fapi.binance.com/fapi/v1/klines?symbol=BTCDOMUSDT&interval=1h&limit=168');
    const historicalData = await response.json();
    priceData = historicalData.map(candle => parseFloat(candle[4]));
    updateChart(priceData);
  }

  // First load
  await fetchAndUpdateDominance();

  // Update every 6 minutes
  setInterval(fetchAndUpdateDominance, 360000);
}
const combinedStreams = new WebSocket('wss://fstream.binance.com/stream?streams=btcusdt@markPrice@1s/ethusdt@markPrice@1s/btcusdt@ticker/!ticker@arr');

combinedStreams.onmessage = function (event) {
  const data = JSON.parse(event.data);
  
  // Handle funding rates
  if (data.stream === 'btcusdt@markPrice@1s' || data.stream === 'ethusdt@markPrice@1s') {
    const coin = data.stream.startsWith('btc') ? 'btc' : 'eth';
    const rate = parseFloat(data.data.r) * 100;
    const foundingCard = document.getElementById(`${coin}-founding-rate`);
    foundingCard.querySelector('.stat-loading').style.display = 'none';
    const foundingValue = foundingCard.querySelector('.stat-value');
    const oldRate = parseFloat(foundingValue.getAttribute('data-prev')) || 0;
    foundingValue.textContent = `${rate.toFixed(4)}%`;
    
    if (rate > oldRate) {
      foundingValue.classList.add('funding-flash-green');
      setTimeout(() => foundingValue.classList.remove('funding-flash-green'), 800);
    } else if (rate < oldRate) {
      foundingValue.classList.add('funding-flash-red');
      setTimeout(() => foundingValue.classList.remove('funding-flash-red'), 800);
    }
    
    foundingValue.setAttribute('data-prev', rate);
    foundingValue.style.display = 'block';
  }

  // Handle BTC 24h price change
  // Handle BTC 24h price change
// Handle BTC 24h price change
if (data.stream === 'btcusdt@ticker') {
  const priceChange = parseFloat(data.data.p);
  const priceChangeCard = document.getElementById('btc-price-change');
  priceChangeCard.querySelector('.stat-loading').style.display = 'none';
  const priceChangeValue = priceChangeCard.querySelector('.stat-value');
  const oldChange = parseFloat(priceChangeValue.getAttribute('data-prev')) || 0;
  
  priceChangeValue.textContent = `${priceChange >= 0 ? '+$' : '-$'}${Math.abs(priceChange).toFixed(2)}`;
  priceChangeValue.style.color = priceChange >= 0 ? '#2ed573' : '#ff4757';
  
  if (priceChange > oldChange) {
    priceChangeValue.classList.add('price-change-flash-green');
    setTimeout(() => priceChangeValue.classList.remove('price-change-flash-green'), 800);
  } else if (priceChange < oldChange) {
    priceChangeValue.classList.add('price-change-flash-red');
    setTimeout(() => priceChangeValue.classList.remove('price-change-flash-red'), 800);
  }
  
  priceChangeValue.setAttribute('data-prev', priceChange);
  priceChangeValue.style.display = 'block';

  // Don't update global volume from BTC data - we'll keep this updated from CoinGecko API only
}

  // Handle ticker data
   // Handle ticker data
   if (data.stream === '!ticker@arr') {
    data.data.forEach((ticker) => {
      const symbol = ticker.s;
      const coin = trendingCoins.find((c) => c.symbol === symbol)?.name;
      if (coin && trendingCardsMap[coin]) {
        const card = trendingCardsMap[coin];
        const price = parseFloat(ticker.c);
        const change7d = parseFloat(ticker.P);
        const marketCap = price * (circulatingSupply[coin] || 1000000);

        const priceEl = card.querySelector('.trending-price');
        const oldPrice = parseFloat(priceEl.getAttribute('data-prev')) || 0;
        priceEl.textContent = formatCurrency(price);
        flashUpdate(priceEl, price, oldPrice);
        priceEl.setAttribute('data-prev', price);

        const changeEl = card.querySelector('.trending-7d');
        changeEl.textContent = `${change7d >= 0 ? '+' : ''}${change7d.toFixed(2)}%`;
        changeEl.className = `trending-7d ${change7d >= 0 ? 'positive' : 'negative'}`;

        const marketCapEl = card.querySelector('.trending-marketcap');
        // Use formatAbbreviatedCurrency instead of formatCurrency
        marketCapEl.textContent = formatAbbreviatedCurrency(marketCap);

        if (currentDetailCoin === coin) {
          document.getElementById('detailPrice').textContent = formatCurrency(price);
          currentCoinPrice = price;
          updateCoinStats(coin, price);
        }
      }
    });
  }
};


 
function updateChart(data) {
  const ctx = document.getElementById('btc-dom-chart').getContext('2d');
  
  if (btcDomChart) btcDomChart.destroy();
  
  btcDomChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: Array(data.length).fill(''),
      datasets: [{
        data: data,
        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--graph-secondary').trim(),
        borderWidth: 1.5,
        pointRadius: 0,
        tension: 0.4,
        fill: false
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: false,
      scales: { x: { display: false }, y: { display: false } },
      plugins: { legend: { display: false } }
    }
  });
}
 
 document.addEventListener('DOMContentLoaded', initBTCDominance);
 
 // Add with your other global variables
let chartType = 'candlestick'; // Default to candlestick

// Add these event listeners after your other initialization code
document.getElementById('lineChartBtn').addEventListener('click', function() {
    document.querySelectorAll('.chart-type-btn').forEach(btn => btn.classList.remove('active'));
    this.classList.add('active');
    chartType = 'line';
    updateDetailChart(currentTimeframe);
});

document.getElementById('candlestickChartBtn').addEventListener('click', function() {
    document.querySelectorAll('.chart-type-btn').forEach(btn => btn.classList.remove('active'));
    this.classList.add('active');
    chartType = 'candlestick';
    updateDetailChart(currentTimeframe);
});


// Modify your fetchHistoricalData function
async function fetchHistoricalData(symbol, hours = 168) {
    let interval;
    if (hours <= 24) {
        interval = '15m';
    } else if (hours <= 168) {
        interval = '1h';
    } else if (hours <= 720) {
        interval = '4h';
    } else {
        interval = '1d';
    }

    const limit = Math.ceil(hours * 60 / parseInt(interval));
    const endpoint = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
    
    try {
        const response = await fetch(endpoint);
        const data = await response.json();
        
        if (chartType === 'candlestick') {
            return data.map(d => ({
                x: new Date(d[0]),
                o: parseFloat(d[1]),
                h: parseFloat(d[2]),
                l: parseFloat(d[3]),
                c: parseFloat(d[4]),
                v: parseFloat(d[5])
            }));
        } else {
            return data.map(d => parseFloat(d[4]));
        }
    } catch (error) {
        console.error('Error fetching historical data:', error);
        return [];
    }
}

// Modify your updateDetailChart function
async function updateDetailChart(hours) {
    if (!currentDetailCoin) return;
    const coin = trendingCoins.find(c => c.name === currentDetailCoin);
    if (!coin) return;

    document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.hours == hours) btn.classList.add('active');
    });

    const data = await fetchHistoricalData(coin.symbol, hours);
    if (!data || data.length === 0) return;

    const ctx = document.getElementById('detailChart').getContext('2d');
    if (detailChartInstance) detailChartInstance.destroy();

    if (chartType === 'candlestick') {
      detailChartInstance = new Chart(ctx, {
          type: 'candlestick',
          data: {
              datasets: [{
                  label: coin.name,
                  data: data,
                  color: {
                    up: 'rgba(46, 213, 115, 0.8)',    // Similar to the gradient start color for buyers
                    down: 'rgba(255, 71, 87, 0.8)',    // Similar to the gradient start color for sellers
                    unchanged: '#ffffff'
                },
                  barPercentage: 0.005,
                  categoryPercentage: 0.8
              }]
          },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: hours <= 24 ? 'hour' : 'day',
                            displayFormats: {
                                hour: 'HH:mm',
                                day: 'MMM dd'
                            }
                        },
                        ticks: { color: '#aaa' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    y: {
                        position: 'right',
                        ticks: { color: '#aaa' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const point = context.raw;
                                return [
                                    `Open: $${point.o.toLocaleString()}`,
                                    `High: $${point.h.toLocaleString()}`,
                                    `Low: $${point.l.toLocaleString()}`,
                                    `Close: $${point.c.toLocaleString()}`
                                ];
                            }
                        }
                    }
                }
            }
        });
    } else {
        // Your existing line chart code
        detailChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map((_, i) => i),
                datasets: [{
                    data: data,
                    borderColor: detailChartColor,
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.2,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { x: { display: false }, y: { display: false } },
                plugins: { legend: { display: false }, tooltip: { enabled: false } }
            }
        });
    }
    
    updateBuyersSellers(data);
}
  </script>
</body>
</html>
